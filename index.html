<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Golf Skins Calculator</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; margin: 0; background:#0f172a; color:#e2e8f0; }
    header { padding: 16px 20px; border-bottom: 1px solid #1f2937; position: sticky; top: 0; background: #0f172a; z-index: 5; }
    h1 { margin: 0; font-size: 20px; }
    main { max-width: 1200px; margin: 0 auto; padding: 18px; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; }
    .card { background:#111827; border:1px solid #1f2937; border-radius:14px; padding:14px; }
    .card h2 { margin:0 0 8px 0; font-size:16px; color:#93c5fd; }
    label { display:block; font-size:12px; color:#cbd5e1; margin-bottom:6px; }
    input, select, button { border-radius:10px; border:1px solid #334155; background:#0b1220; color:#e2e8f0; padding:8px 10px; }
    input:focus, select:focus, button:focus { outline:2px solid #2563eb; outline-offset: 2px; }
    table { width:100%; border-collapse: collapse; }
    th, td { border-bottom:1px solid #1f2937; padding:8px 6px; text-align:center; font-variant-numeric: tabular-nums; }
    th { position: sticky; top: 62px; background:#0f172a; z-index: 4; }
    .pill { display:inline-block; padding:2px 8px; border:1px solid #334155; border-radius:999px; font-size:12px; }
    .grid { display:grid; gap:12px; }
    .grid-3 { grid-template-columns: repeat(3, minmax(0,1fr)); }
    .grid-2 { grid-template-columns: repeat(2, minmax(0,1fr)); }
    .muted { color:#94a3b8; }
    .success { color:#34d399; }
    .warn { color:#f59e0b; }
    .danger { color:#f87171; }
    .winner { background:#052e16; }
    .tie { background:#1f2937; }
    .carry { background:#0b1220; }
    .totals { font-weight: 600; background:#0b1220; }
    .right { text-align:right; }
    .small { font-size:12px; }
    .flex-between { display:flex; justify-content:space-between; align-items:center; gap:8px; }
    .nowrap { white-space: nowrap; }
  </style>
</head>
<body>
  <header class="flex-between">
    <h1>Golf Skins Calculator</h1>
    <div class="small muted">MVP · Net or Gross · Carryovers · 2–6 players</div>
  </header>
  <main>

    <section class="row">
      <div class="card" style="flex:2; min-width: 320px;">
        <h2>Players & Settings</h2>
        <div class="row">
          <div>
            <label>Game Type</label>
            <select id="gameType">
              <option value="net" selected>Net Skins (full handicap)</option>
              <option value="gross">Gross Skins (no handicap)</option>
            </select>
          </div>
          <div>
            <label>Carryovers on Ties</label>
            <select id="carryovers">
              <option value="yes" selected>Yes</option>
              <option value="no">No</option>
            </select>
          </div>
          <div>
            <label>Skin Value ($)</label>
            <input id="skinValue" type="number" step="0.01" value="1.00" />
          </div>
          <div>
            <label>Players</label>
            <select id="playerCount">
              <option>2</option>
              <option selected>3</option>
              <option>4</option>
              <option>5</option>
              <option>6</option>
            </select>
          </div>
          <div style="align-self:flex-end;">
            <button id="applyPlayerCount">Apply</button>
          </div>
        </div>
        <div id="players" class="grid grid-3" style="margin-top:10px;"></div>
      </div>

      <div class="card" style="flex:1; min-width: 280px;">
        <h2>Course Setup</h2>
        <div class="grid grid-2">
          <div>
            <label>Par (CSV, 18 values)</label>
            <input id="parCsv" placeholder="4,4,3,5,..." />
          </div>
          <div>
            <label>Stroke Index/HCP (1–18, CSV)</label>
            <input id="siCsv" placeholder="11,3,15,1,..." />
          </div>
        </div>
        <div class="small muted" style="margin-top:8px;">If empty, uses typical defaults.</div>
        <div style="margin-top:10px;" class="flex-between">
          <button id="loadDefaults">Load sensible defaults</button>
          <button id="applyCourse">Apply to card</button>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:14px;">
      <h2>Scorecard</h2>
      <div class="small muted" style="margin-bottom:6px;">Enter gross scores. Net is computed automatically if selected.</div>
      <div style="overflow:auto;">
        <table id="cardTable"></table>
      </div>
      <div class="flex-between" style="margin-top:12px; gap:10px; flex-wrap:wrap;">
        <div class="small muted">Legend: <span class="pill">Winner</span> unique low | <span class="pill">Tie</span> no skin | <span class="pill">Carry</span> holes stacked</div>
        <div class="right">
          <button id="computeBtn">Compute Skins</button>
          <button id="resetBtn" style="margin-left:8px;">Reset</button>
        </div>
      </div>
    </section>

    <section class="row" style="margin-top:14px;">
      <div class="card" style="flex:1; min-width: 280px;">
        <h2>Results</h2>
        <div id="results"></div>
      </div>
      <div class="card" style="flex:1; min-width: 280px;">
        <h2>Payouts</h2>
        <div id="payouts"></div>
      </div>
    </section>

  </main>

  <script>
    // --- Utility helpers ---
    const range = (n) => Array.from({length:n}, (_,i)=>i);
    const clamp = (n, lo, hi) => Math.max(lo, Math.min(hi, n));

    // --- State ---
    let state = {
      gameType: 'net',
      carryovers: true,
      skinValue: 1.00,
      players: [
        { name: 'Alice', handicap: 12 },
        { name: 'Bob', handicap: 8 },
        { name: 'Charlie', handicap: 20 },
      ],
      par: new Array(18).fill(4).map((v,i)=> [3,4,4,5][[2,0,1,3][i%4]]), // 4/4/3/5-ish
      si: [11,3,15,1,9,7,17,5,13,12,4,16,2,10,8,18,6,14], // typical mix
      scores: [] // [holeIndex][playerIndex] => gross
    };

    // Initialize empty scores
    const resetScores = () => {
      state.scores = range(18).map(()=> range(state.players.length).map(()=>''));
    };

    // Build Players UI
    function renderPlayers() {
      const wrap = document.getElementById('players');
      wrap.innerHTML = '';
      state.players.forEach((p, idx)=>{
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="row" style="align-items: end;">
            <div style="flex:1; min-width:120px;">
              <label>Player ${idx+1} Name</label>
              <input data-ptype="name" data-index="${idx}" value="${p.name}" />
            </div>
            <div>
              <label>Handicap (Course)</label>
              <input data-ptype="hcp" data-index="${idx}" type="number" value="${p.handicap}" />
            </div>
            <div>
              <label class="muted">&nbsp;</label>
              <button data-ptype="remove" data-index="${idx}">Remove</button>
            </div>
          </div>`;
        wrap.appendChild(card);
      });
      const add = document.createElement('button');
      add.textContent = 'Add Player';
      add.onclick = () => { state.players.push({name:`Player ${state.players.length+1}`, handicap: 0}); resetScores(); buildTable(); renderPlayers(); };
      wrap.appendChild(add);

      wrap.querySelectorAll('input[data-ptype="name"]').forEach(inp=>{
        inp.addEventListener('input', (e)=>{ const i=+e.target.dataset.index; state.players[i].name = e.target.value; buildTable(); });
      });
      wrap.querySelectorAll('input[data-ptype="hcp"]').forEach(inp=>{
        inp.addEventListener('input', (e)=>{ const i=+e.target.dataset.index; state.players[i].handicap = clamp(parseInt(e.target.value||'0',10),0,54); });
      });
      wrap.querySelectorAll('button[data-ptype="remove"]').forEach(btn=>{
        btn.addEventListener('click', (e)=>{ const i=+e.target.dataset.index; state.players.splice(i,1); resetScores(); buildTable(); renderPlayers(); });
      });
    }

    // Build Card Table
    function buildTable() {
      const tbl = document.getElementById('cardTable');
      const cols = 3 + state.players.length; // Hole, Par, SI, players...
      let html = '<thead><tr>';
      html += '<th>Hole</th><th>Par</th><th>SI</th>';
      state.players.forEach(p=> html += `<th>${p.name}</th>`);
      html += '</tr></thead><tbody>';
      for (let h=0; h<18; h++) {
        html += `<tr data-hole="${h}">`;
        html += `<td>${h+1}</td>`;
        html += `<td><input class="par" data-hole="${h}" type="number" value="${state.par[h]}" /></td>`;
        html += `<td><input class="si" data-hole="${h}" type="number" value="${state.si[h]}" /></td>`;
        for (let p=0; p<state.players.length; p++) {
          const v = state.scores[h]?.[p] ?? '';
          html += `<td><input class="score" data-hole="${h}" data-player="${p}" type="number" inputmode="numeric" value="${v}" /></td>`;
        }
        html += '</tr>';
      }
      // Totals row
      html += `<tr class="totals"><td colspan="3" class="right">Front / Back / Total</td>`;
      for (let p=0; p<state.players.length; p++) {
        html += `<td id="tot-${p}">—</td>`;
      }
      html += '</tr>';
      html += '</tbody>';
      tbl.innerHTML = html;

      // wire inputs
      tbl.querySelectorAll('input.par').forEach(inp=> inp.addEventListener('input', e=>{
        state.par[+e.target.dataset.hole] = parseInt(e.target.value||'4',10);
      }));
      tbl.querySelectorAll('input.si').forEach(inp=> inp.addEventListener('input', e=>{
        state.si[+e.target.dataset.hole] = parseInt(e.target.value||'1',10);
      }));
      tbl.querySelectorAll('input.score').forEach(inp=> inp.addEventListener('input', e=>{
        const h = +e.target.dataset.hole, p = +e.target.dataset.player;
        state.scores[h][p] = e.target.value === '' ? '' : parseInt(e.target.value,10);
        updateRunningTotals();
      }));

      updateRunningTotals();
    }

    function updateRunningTotals(){
      for (let p=0; p<state.players.length; p++) {
        let front=0, back=0;
        for (let h=0; h<9; h++) front += Number.isFinite(state.scores[h][p]) ? state.scores[h][p] : 0;
        for (let h=9; h<18; h++) back  += Number.isFinite(state.scores[h][p]) ? state.scores[h][p] : 0;
        const tot = front + back;
        document.getElementById(`tot-${p}`).textContent = `${front}/${back}/${tot}`;
      }
    }

    // Handicap stroke allocation for each hole per player
    function strokesForPlayerOnHole(playerHcp, si) {
      // full handicap: player gets 1 stroke on holes with SI <= playerHcp
      // and an extra stroke on holes with SI <= (playerHcp - 18), etc.
      let strokes = 0;
      if (playerHcp <= 0) return 0;
      if (si <= playerHcp) strokes += 1;
      if (playerHcp > 18 && si <= (playerHcp - 18)) strokes += 1;
      if (playerHcp > 36 && si <= (playerHcp - 36)) strokes += 1;
      return strokes;
    }

    function computeSkins(){
      // clear row classes
      document.querySelectorAll('#cardTable tbody tr').forEach(tr=>{
        tr.classList.remove('winner','tie','carry');
      });

      const netGame = state.gameType === 'net';
      const carry = state.carryovers;
      const nPlayers = state.players.length;
      const skinValue = parseFloat(document.getElementById('skinValue').value || '1');

      let carryStack = 1; // number of skins that current hole is worth
      let skins = Array(nPlayers).fill(0);
      let skinHoles = Array(nPlayers).fill(0);
      let resultsLog = [];

      for (let h=0; h<18; h++) {
        const row = state.scores[h];
        const valid = row.every(v => v !== '' && Number.isFinite(v));
        if (!valid) { resultsLog.push({hole:h+1, note:'Incomplete scores — treated as no result'}); continue; }

        // compute adjusted scores
        const adj = row.map((gross, p)=>{
          const si = state.si[h];
          const strokes = netGame ? strokesForPlayerOnHole(parseInt(state.players[p].handicap||0,10), si) : 0;
          return gross - strokes;
        });

        // find unique low
        const min = Math.min(...adj);
        const winners = adj.map((v,i)=> v===min ? i : -1).filter(i=>i>=0);

        if (winners.length === 1) {
          const w = winners[0];
          skins[w] += carry ? carryStack : 1;
          skinHoles[w] += 1;
          resultsLog.push({hole:h+1, winner:w, skinsWon: carry ? carryStack : 1, adj, carryStack});
          carryStack = 1; // reset
          markRow(h, 'winner');
        } else {
          // tie: no skin; may carry
          resultsLog.push({hole:h+1, tie:true, adj, carryStack});
          if (carry) {
            carryStack += 1;
            markRow(h, 'carry');
          } else {
            markRow(h, 'tie');
          }
        }
      }

      // Render results
      renderResults(resultsLog, skins, skinHoles, skinValue);
    }

    function markRow(h, cls){
      const tr = document.querySelector(`#cardTable tbody tr[data-hole="${h}"]`);
      if (tr) tr.classList.add(cls);
    }

    function renderResults(log, skins, skinHoles, skinValue){
      const res = document.getElementById('results');
      const pay = document.getElementById('payouts');
      const names = state.players.map(p=>p.name);

      let html = '<div class="small muted">Per-hole results</div><ol style="margin-top:6px; padding-left:18px;">';
      for (const item of log){
        const hole = `<span class="pill">H${item.hole}</span>`;
        if (item.winner !== undefined){
          html += `<li>${hole} — <span class="success">${names[item.winner]}</span> won ${item.skinsWon} skin(s).</li>`;
        } else if (item.tie){
          html += `<li>${hole} — <span class="warn">Tie</span> ${state.carryovers? '(carried)' : ''}</li>`;
        } else {
          html += `<li>${hole} — <span class="muted">Incomplete</span></li>`;
        }
      }
      html += '</ol>';

      const totalSkins = skins.reduce((a,b)=>a+b,0);

      html += '<hr style="border:none;border-top:1px solid #1f2937; margin:10px 0;" />';
      html += '<div class="grid grid-2">';
      html += '<div><h3 class="small muted" style="margin:0 0 6px 0;">Skins by player</h3><table>';
      html += '<tr><th>Player</th><th>Skins</th><th>Holes Won</th></tr>';
      state.players.forEach((p,i)=>{ html += `<tr><td class="right">${p.name}</td><td>${skins[i]}</td><td>${skinHoles[i]}</td></tr>`; });
      html += `<tr class="totals"><td class="right">Total</td><td>${totalSkins}</td><td>—</td></tr>`;
      html += '</table></div>';

      // payouts
      const potPerSkin = skinValue; // simple model: $ per skin
      const payouts = skins.map(s => s * potPerSkin);
      let payHtml = '<h3 class="small muted" style="margin:0 0 6px 0;">Payouts</h3><table>';
      payHtml += '<tr><th>Player</th><th>Amount ($)</th></tr>';
      state.players.forEach((p,i)=>{ payHtml += `<tr><td class="right">${p.name}</td><td>${payouts[i].toFixed(2)}</td></tr>`; });
      payHtml += `<tr class="totals"><td class="right">Total Paid</td><td>${(payouts.reduce((a,b)=>a+b,0)).toFixed(2)}</td></tr>`;
      payHtml += '</table>';

      res.innerHTML = html;
      pay.innerHTML = payHtml;
    }

    // --- Controls wiring ---
    document.getElementById('gameType').addEventListener('change', e=> state.gameType = e.target.value);
    document.getElementById('carryovers').addEventListener('change', e=> state.carryovers = (e.target.value==='yes'));
    document.getElementById('skinValue').addEventListener('input', e=> state.skinValue = parseFloat(e.target.value||'1'));

    document.getElementById('playerCount').addEventListener('change', ()=>{});
    document.getElementById('applyPlayerCount').addEventListener('click', ()=>{
      const n = parseInt(document.getElementById('playerCount').value,10);
      const existing = state.players.length;
      if (n > existing) {
        for (let i=existing; i<n; i++) state.players.push({name:`Player ${i+1}`, handicap:0});
      } else if (n < existing) {
        state.players = state.players.slice(0,n);
      }
      resetScores();
      renderPlayers();
      buildTable();
    });

    document.getElementById('loadDefaults').addEventListener('click', ()=>{
      state.par = [4,4,3,5,4,4,3,5,4, 4,4,3,5,4,4,3,5,4];
      state.si  = [11,3,15,1,9,7,17,5,13, 12,4,16,2,10,8,18,6,14];
      document.getElementById('parCsv').value = state.par.join(',');
      document.getElementById('siCsv').value = state.si.join(',');
    });

    document.getElementById('applyCourse').addEventListener('click', ()=>{
      const parseCsv = (txt, def, mapFn) => {
        if (!txt.trim()) return def.slice();
        const a = txt.split(',').map(s=>parseInt(s.trim(),10)).filter(n=>Number.isFinite(n));
        if (a.length !== 18) return def.slice();
        return mapFn ? a.map(mapFn) : a;
      };
      state.par = parseCsv(document.getElementById('parCsv').value, state.par);
      state.si  = parseCsv(document.getElementById('siCsv').value, state.si, n=> clamp(n,1,18));
      buildTable();
    });

    document.getElementById('computeBtn').addEventListener('click', computeSkins);
    document.getElementById('resetBtn').addEventListener('click', ()=>{ resetScores(); buildTable(); document.getElementById('results').innerHTML=''; document.getElementById('payouts').innerHTML='';});

    // Initial render
    resetScores();
    renderPlayers();
    buildTable();
  </script>
</body>
</html>
